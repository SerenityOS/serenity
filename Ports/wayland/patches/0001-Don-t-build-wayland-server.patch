From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Peter Elliott <pelliott@ualberta.ca>
Date: Sat, 11 Feb 2023 13:22:20 -0700
Subject: [PATCH] Don't build wayland-server

---
 meson.build     |  4 ++--
 src/meson.build | 55 -------------------------------------------------
 2 files changed, 2 insertions(+), 57 deletions(-)

diff --git a/meson.build b/meson.build
index ef34ba4a5511d7ccf25edd1c048752a737f9bca9..3b9c66693b1028bdd738d7d09284000582d597ce 100644
--- a/meson.build
+++ b/meson.build
@@ -80,8 +80,8 @@ if get_option('libraries')
 	ffi_dep = dependency('libffi')
 
 	decls = [
-		{ 'header': 'sys/signalfd.h', 'symbol': 'SFD_CLOEXEC' },
-		{ 'header': 'sys/timerfd.h', 'symbol': 'TFD_CLOEXEC' },
+        #{ 'header': 'sys/signalfd.h', 'symbol': 'SFD_CLOEXEC' },
+        #{ 'header': 'sys/timerfd.h', 'symbol': 'TFD_CLOEXEC' },
 		{ 'header': 'time.h', 'symbol': 'CLOCK_MONOTONIC' },
 	]
 
diff --git a/src/meson.build b/src/meson.build
index 984e34abccc095890e5e05fde4f11dbf99967ab8..e9f041c2a6b43f46b7408c8123c909e5b482c738 100644
--- a/src/meson.build
+++ b/src/meson.build
@@ -170,59 +170,6 @@ if get_option('libraries')
 		error('We probably need to bump the SONAME of libwayland-server and -client')
 	endif
 
-	wayland_server = library(
-		'wayland-server',
-		sources: [
-			wayland_server_protocol_core_h,
-			wayland_server_protocol_h,
-			wayland_protocol_c,
-			'wayland-server.c',
-			'wayland-shm.c',
-			'event-loop.c'
-		],
-		# To avoid an unnecessary SONAME bump, wayland 1.x.y produces
-		# libwayland-server.so.0.x.y.
-		version: '.'.join(['0', wayland_version[1], wayland_version[2]]),
-		dependencies: [
-			epoll_dep,
-			ffi_dep,
-			wayland_private_dep,
-			wayland_util_dep,
-			mathlib_dep,
-			threads_dep,
-			rt_dep
-		],
-		include_directories: root_inc,
-		install: true
-	)
-
-	wayland_server_dep = declare_dependency(
-		link_with: wayland_server,
-		include_directories: [ root_inc, include_directories('.') ],
-		dependencies: [ epoll_dep, ffi_dep, mathlib_dep, threads_dep ],
-		sources: [
-			wayland_server_protocol_core_h,
-			wayland_server_protocol_h
-		]
-	)
-
-	pkgconfig.generate(
-		wayland_server,
-		name: 'Wayland Server',
-		description: 'Server side implementation of the Wayland protocol',
-		version: meson.project_version(),
-		filebase: 'wayland-server',
-		libraries: mathlib_dep,
-		variables: [
-			'datarootdir=' + join_paths('${prefix}', get_option('datadir')),
-			'pkgdatadir=' + join_paths('${pc_sysrootdir}${datarootdir}', meson.project_name())
-		]
-	)
-
-	if meson.version().version_compare('>= 0.54.0')
-		meson.override_dependency('wayland-server', wayland_server_dep)
-	endif
-
 	wayland_client = library(
 		'wayland-client',
 		sources: [
@@ -274,8 +221,6 @@ if get_option('libraries')
 
 	install_headers([
 		'wayland-util.h',
-		'wayland-server.h',
-		'wayland-server-core.h',
 		'wayland-client.h',
 		'wayland-client-core.h',
 	])
